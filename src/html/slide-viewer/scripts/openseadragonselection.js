!function(t){"use strict";function e(e){if(this.isSelecting){this.viewer.setMouseNavEnabled(!1);var i=this.viewer.viewport.deltaPointsFromPixels(e.delta,!0),s=this.viewer.viewport.pointFromPixel(e.position,!0),n=new t.Point(s.x-i.x,s.y-i.y);if(this.rect){var r;if(this.restrictToImage&&(r=this.rect.clone()),this.rectDone)if(this.allowRotation){var h=this.rect.getAngleFromCenter(n),o=this.rect.getAngleFromCenter(s);this.rect.rotation=(this.rect.rotation+h-o)%Math.PI}else this.outerTracker.setTracking(!1);else this.startRotated?this.rect=l(this.rotatedStartPoint,s,this.startRotatedHeight):this.useConstraint?(this.rect.width+=i.x,this.rect.height=this.rect.width/this.constraintWidth*this.constraintHeight):(this.rect.width+=i.x,this.rect.height+=i.y);var a=this.viewer.world.getHomeBounds();this.restrictToImage&&!this.rect.fitsIn(new t.Rect(0,0,a.width,a.height))&&(this.rect=r)}else{if(this.restrictToImage){if(!d(this,n))return;g(i,s)}this.startRotated?(this.rotatedStartPoint=n,this.rect=l(n,s,this.startRotatedHeight)):this.useConstraint?this.rect=new t.SelectionRect(n.x,n.y,i.x,i.y):this.rect=new t.SelectionRect(n.x,n.y,i.x,i.y),this.rectDone=!1}this.draw()}}function i(){this.rect&&(this.rect.width<0&&(this.rect.x+=this.rect.width,this.rect.width=Math.abs(this.rect.width)),this.rect.height<0&&(this.rect.y+=this.rect.height,this.rect.height=Math.abs(this.rect.height))),this.viewer.setMouseNavEnabled(!0),this.rectDone=!0}function s(){}function n(t,e,i,s){var n=parseInt(t.style.top),r=parseInt(t.style.left),h=parseInt(t.style.width),o=(parseInt(t.style.height),parseInt(e.style.width)),a=parseInt(e.style.height);n<0?e.style.marginTop=-n+"px":n+a>=s&&(e.style.marginTop=s-(n+a)+"px"),r+h+o+10>=i?e.style.marginLeft=-o-10+"px":e.style.marginLeft="calc(100% + 10px)"}function r(e){t.addClass(this.element,"dragging");var i=this.viewer.viewport.deltaPointsFromPixels(e.delta,!0);this.rect.x+=i.x,this.rect.y+=i.y;var s=this.viewer.world.getHomeBounds();this.restrictToImage&&!this.rect.fitsIn(new t.Rect(0,0,s.width,s.height))&&(this.rect.x-=i.x,this.rect.y-=i.y),this.draw()}function h(){t.removeClass(this.element,"dragging")}function o(e,i){var s,n=i.delta,r=this.rect.getDegreeRotation(),h=this.restrictToImage?this.rect.clone():null;switch(0!==r&&(n=n.rotate(-1*r,new t.Point(0,0)),s=this.rect.getCenter()),n=this.viewer.viewport.deltaPointsFromPixels(n,!0),e){case 0:if(this.useConstraint){this.rect.y+=n.y,this.rect.height-=n.y;var o=this.rect.x+this.rect.width;this.rect.width=this.rect.height/this.constraintHeight*this.constraintWidth,this.rect.x=o-this.rect.width;break}this.rect.y+=n.y,this.rect.height-=n.y;break;case 1:if(this.useConstraint){this.rect.width+=n.x,this.rect.height=this.rect.width/this.constraintWidth*this.constraintHeight;break}this.rect.width+=n.x;break;case 2:if(this.useConstraint){this.rect.height+=n.y,this.rect.width=this.rect.height/this.constraintHeight*this.constraintWidth;break}this.rect.height+=n.y;break;case 3:if(this.useConstraint){this.rect.x+=n.x,this.rect.width-=n.x;var o=this.rect.y+this.rect.height;this.rect.height=this.rect.width/this.constraintWidth*this.constraintHeight,this.rect.y=o-this.rect.height;break}this.rect.x+=n.x,this.rect.width-=n.x;break;case.5:if(this.useConstraint){this.rect.y+=n.y,this.rect.height-=n.y;var o=this.rect.x+this.rect.width;this.rect.width=this.rect.height/this.constraintHeight*this.constraintWidth,this.rect.x=o-this.rect.width;break}this.rect.y+=n.y,this.rect.height-=n.y,this.rect.x+=n.x,this.rect.width-=n.x;break;case 1.5:if(this.useConstraint){this.rect.y+=n.y,this.rect.height-=n.y,this.rect.width=this.rect.height/this.constraintHeight*this.constraintWidth;break}this.rect.y+=n.y,this.rect.height-=n.y,this.rect.width+=n.x;break;case 2.5:if(this.useConstraint){this.rect.height+=n.y,this.rect.width=this.rect.height/this.constraintHeight*this.constraintWidth;break}this.rect.width+=n.x,this.rect.height+=n.y;break;case 3.5:if(this.useConstraint){this.rect.height+=n.y;var o=this.rect.x+this.rect.width;this.rect.width=this.rect.height/this.constraintHeight*this.constraintWidth,this.rect.x=o-this.rect.width;break}this.rect.height+=n.y,this.rect.x+=n.x,this.rect.width-=n.x}if(0!==r){var a=this.rect.getCenter(),c=a.rotate(r,s);n=c.minus(a),this.rect.x+=n.x,this.rect.y+=n.y}var l=this.viewer.world.getHomeBounds();this.restrictToImage&&!this.rect.fitsIn(new t.Rect(0,0,l.width,l.height))&&(this.rect=h),this.draw()}function a(){this.rect.width<0&&(this.rect.x+=this.rect.width,this.rect.width=Math.abs(this.rect.width)),this.rect.height<0&&(this.rect.y+=this.rect.height,this.rect.height=Math.abs(this.rect.height))}function c(t){var e=t.keyCode?t.keyCode:t.charCode;13===e?this.confirm():String.fromCharCode(e)===this.keyboardShortcut&&this.toggleState()}function l(e,i,s){if(e.x>i.x){var n=e;e=i,i=n}var r=i.minus(e),h=e.distanceTo(i),o=-1*Math.atan2(r.x,r.y)+Math.PI/2,a=new t.Point(r.x/2+e.x,r.y/2+e.y),c=new t.SelectionRect(a.x-h/2,a.y-s/2,h,s,o),l=new t.Point(0,s);return l=l.rotate(c.getDegreeRotation(),new t.Point(0,0)),c.x+=l.x/2,c.y+=l.y/2,c}function d(t,e){var i=t.viewer.world.getHomeBounds();return e.x>=0&&e.x<=i.width&&e.y>=0&&e.y<=i.height}function g(t,e){var i;for(var s in{x:0,y:0})i=e[s]-t[s],i<1&&i>0&&(e[s]>1?(t[s]-=e[s]-1,e[s]=1):e[s]<0&&(t[s]-=e[s],e[s]=0))}if(!t.version||t.version.major<2)throw new Error("This version of OpenSeadragonSelection requires OpenSeadragon version 2.0.0+");t.Viewer.prototype.selection=function(e){return this.selectionInstance&&!e||(e=e||{},e.viewer=this,this.selectionInstance=new t.Selection(e)),this.selectionInstance},t.Selection=function(n){t.extend(!0,this,{viewer:null,isSelecting:!1,buttonActiveImg:!1,rectDone:!0,element:null,toggleButton:null,showSelectionControl:!0,showConfirmDenyButtons:!0,styleConfirmDenyButtons:!0,returnPixelCoordinates:!0,keyboardShortcut:"c",rect:null,allowRotation:!0,startRotated:!1,startRotatedHeight:.1,restrictToImage:!1,onSelection:null,onOpen:null,inputEvent:null,prefixUrl:null,navImages:{selection:{REST:"selection_rest.png",GROUP:"selection_grouphover.png",HOVER:"selection_hover.png",DOWN:"selection_pressed.png"},selectionConfirm:{REST:"selection_confirm_rest.png",GROUP:"selection_confirm_grouphover.png",HOVER:"selection_confirm_hover.png",DOWN:"selection_confirm_pressed.png"},selectionCancel:{REST:"selection_cancel_rest.png",GROUP:"selection_cancel_grouphover.png",HOVER:"selection_cancel_hover.png",DOWN:"selection_cancel_pressed.png"}},handleStyle:{top:"50%",left:"50%",width:"6px",height:"6px",margin:"-4px 0 0 -4px",background:"#000",border:"1px solid #ccc"},cornersStyle:{width:"6px",height:"6px",background:"#000",border:"1px solid #ccc"},onCancel:null,showButton:!0,transition:0,useConstraint:!1,constraintWidth:3,constraintHeight:2},n),t.extend(!0,this.navImages,this.viewer.navImages),this.element||(this.element=t.makeNeutralElement("div"),this.element.style.background="rgba(0, 0, 0, 0.1)",this.element.className="selection-box"),this.borders=this.borders||[];for(var l,d=[],g=0;g<4;g++)this.borders[g]||(this.borders[g]=t.makeNeutralElement("div"),this.borders[g].className="border-"+g,this.borders[g].style.position="absolute",this.borders[g].style.width="1px",this.borders[g].style.height="1px",this.borders[g].style.background="#fff"),l=t.makeNeutralElement("div"),l.className="border-"+g+"-handle",l.style.position="absolute",l.style.top=this.handleStyle.top,l.style.left=this.handleStyle.left,l.style.width=this.handleStyle.width,l.style.height=this.handleStyle.height,l.style.margin=this.handleStyle.margin,l.style.background=this.handleStyle.background,l.style.border=this.handleStyle.border,new t.MouseTracker({element:this.borders[g],dragHandler:o.bind(this,g),dragEndHandler:a.bind(this,g)}),d[g]=t.makeNeutralElement("canvas"),d[g].className="corner-"+g+"-handle",d[g].style.position="absolute",d[g].style.width=this.cornersStyle.width,d[g].style.height=this.cornersStyle.height,d[g].style.background=this.cornersStyle.background,d[g].style.border=this.cornersStyle.border,new t.MouseTracker({element:d[g],dragHandler:o.bind(this,g+.5),dragEndHandler:a.bind(this,g)}),this.borders[g].appendChild(l),this.element.appendChild(this.borders[g]),setTimeout(this.element.appendChild.bind(this.element,d[g]),0);this.borders[0].style.top=0,this.borders[0].style.width="100%",this.borders[1].style.right=0,this.borders[1].style.height="100%",this.borders[2].style.bottom=0,this.borders[2].style.width="100%",this.borders[3].style.left=0,this.borders[3].style.height="100%",d[0].style.top="-3px",d[0].style.left="-3px",d[1].style.top="-3px",d[1].style.right="-3px",d[2].style.bottom="-3px",d[2].style.right="-3px",d[3].style.bottom="-3px",d[3].style.left="-3px";var u=t.makeNeutralElement("div");u.style.width="200px",u.style.height="auto",u.style.background="red",u.style.marginLeft="calc(100% + 10px)",u.style.marginTop="0px",u.id="keyImageProperties";var y=this.viewer,m=document.createElement("div"),w=document.createTextNode("Tiêu đề");m.appendChild(w),u.appendChild(m);var p=document.createElement("input");p.id="keyImageTitle",p.setAttribute("type","text"),u.appendChild(p),p.addEventListener("click",function(){y.selectionInstance.outerTracker.setTracking(!1),y.selectionInstance.innerTracker.setTracking(!1),y.innerTracker.keyHandler=!1,y.innerTracker.setTracking(!1),y.selectionInstance.keyboardShortcut=null,p.focus()},!0),p.addEventListener("blur",function(){y.selectionInstance.outerTracker.setTracking(!0),y.selectionInstance.innerTracker.setTracking(!0),y.innerTracker.keyHandler=!0,y.innerTracker.setTracking(!0),y.selectionInstance.keyboardShortcut=t.keyboardShortcut},!0),p.addEventListener("keydown",this.inputEvent.keydown);var v=document.createElement("div");w=document.createTextNode("Ghi chú"),v.appendChild(w),u.appendChild(v);var f=document.createElement("textarea");f.id="keyImageNote",u.appendChild(f),f.rows="5",f.addEventListener("click",function(){y.selectionInstance.outerTracker.setTracking(!1),y.selectionInstance.innerTracker.setTracking(!1),y.innerTracker.keyHandler=!1,y.innerTracker.setTracking(!1),y.selectionInstance.keyboardShortcut=null,f.focus()},!0),f.addEventListener("blur",function(){y.selectionInstance.outerTracker.setTracking(!0),y.selectionInstance.innerTracker.setTracking(!0),y.innerTracker.keyHandler=!0,y.innerTracker.setTracking(!0),y.selectionInstance.keyboardShortcut=t.keyboardShortcut},!0),f.addEventListener("keydown",this.inputEvent.keydown);var k=this,b=document.createElement("div");b.className+="selection-btn-group",m.append(b),m.className+="selection-title";var T=this.configBtn();b.appendChild(T);var x=document.createElement("div");x.className+="btn-cancel",x.innerHTML='<i class="fas fa-times"></i>',x.onclick=function(){k.cancel()},b.appendChild(x);var S=document.createElement("div");S.className="btn-confirm",S.innerHTML="Lưu",S.onclick=function(){k.confirm()},u.appendChild(S),setTimeout(this.element.appendChild.bind(this.element,u),0),this.overlay||(this.overlay=new t.SelectionOverlay(this.element,this.rect||new t.SelectionRect)),this.innerTracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,dragHandler:t.delegate(this,r),dragEndHandler:t.delegate(this,h),clickHandler:t.delegate(this,s)}),this.outerTracker=new t.MouseTracker({element:this.viewer.canvas,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,dragHandler:t.delegate(this,e),dragEndHandler:t.delegate(this,i),clickHandler:t.delegate(this,s),startDisabled:!this.isSelecting}),this.keyboardShortcut&&t.addEvent(this.viewer.container,"keypress",t.delegate(this,c),!1);var C=this.prefixUrl||this.viewer.prefixUrl||"",I=this.viewer.buttons&&this.viewer.buttons.buttons,R=I?this.viewer.buttons.buttons[0]:null,H=R?R.onFocus:null,E=R?R.onBlur:null;if(this.showSelectionControl&&(this.toggleButton=new t.Button({element:this.toggleButton?t.getElement(this.toggleButton):null,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,tooltip:t.getString("Tooltips.SelectionToggle")||"Toggle selection",srcRest:C+this.navImages.selection.REST,srcGroup:C+this.navImages.selection.GROUP,srcHover:C+this.navImages.selection.HOVER,srcDown:C+this.navImages.selection.DOWN,onRelease:this.toggleState.bind(this),onFocus:H,onBlur:E}),I&&(this.viewer.buttons.buttons.push(this.toggleButton),this.viewer.buttons.element.appendChild(this.toggleButton.element)),this.toggleButton.imgDown&&(this.buttonActiveImg=this.toggleButton.imgDown.cloneNode(!0),this.toggleButton.element.appendChild(this.buttonActiveImg))),this.showConfirmDenyButtons){this.confirmButton=new t.Button({element:this.confirmButton?t.getElement(this.confirmButton):null,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,tooltip:t.getString("Tooltips.SelectionConfirm")||"Confirm selection",srcRest:C+this.navImages.selectionConfirm.REST,srcGroup:C+this.navImages.selectionConfirm.GROUP,srcHover:C+this.navImages.selectionConfirm.HOVER,srcDown:C+this.navImages.selectionConfirm.DOWN,onRelease:this.confirm.bind(this),onFocus:H,onBlur:E});var S=this.confirmButton.element;S.classList.add("confirm-button"),S.style.display=this.showButton?"":"none",this.element.appendChild(S),this.cancelButton=new t.Button({element:this.cancelButton?t.getElement(this.cancelButton):null,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,tooltip:t.getString("Tooltips.SelectionCancel")||"Cancel selection",srcRest:C+this.navImages.selectionCancel.REST,srcGroup:C+this.navImages.selectionCancel.GROUP,srcHover:C+this.navImages.selectionCancel.HOVER,srcDown:C+this.navImages.selectionCancel.DOWN,onRelease:this.cancel.bind(this),onFocus:H,onBlur:E});var B=this.cancelButton.element;B.classList.add("cancel-button"),B.style.display=this.showButton?"":"none",this.element.appendChild(B),this.styleConfirmDenyButtons&&(S.style.position="absolute",S.style.top="50%",S.style.left="50%",S.style.transform="translate(-100%, -50%)",B.style.position="absolute",B.style.top="50%",B.style.left="50%",B.style.transform="translate(0, -50%)")}this.viewer.addHandler("selection",this.onSelection),this.viewer.addHandler("open",this.draw.bind(this)),this.viewer.addHandler("animation",this.draw.bind(this)),this.viewer.addHandler("resize",this.draw.bind(this)),this.viewer.addHandler("rotate",this.draw.bind(this))},t.extend(t.Selection.prototype,t.ControlDock.prototype,{toggleState:function(){return this.setState(!this.isSelecting)},setState:function(t){return this.isSelecting=t,this.outerTracker.setTracking(t),t?this.draw():this.undraw(),this.buttonActiveImg&&(this.buttonActiveImg.style.visibility=t?"visible":"hidden"),this.viewer.raiseEvent("selection_toggle",{enabled:t}),this},setAllowRotation:function(t){this.allowRotation=t},enable:function(){return this.setState(!0)},disable:function(){return this.setState(!1)},draw:function(){return this.rect&&(this.overlay.update(this.rect.normalize()),this.overlay.drawHTML(this.viewer.drawer.container,this.viewer.viewport)),this.element&&this.element.children[10]&&n(this.element,this.element.children[10],this.viewer.viewport.getContainerSize().x,this.viewer.viewport.getContainerSize().y),this},undraw:function(){return jQuery(this.element).animate({opacity:0},this.transition),setTimeout(function(t){t.overlay.destroy(),jQuery(t.element).css("opacity",1),t.rect=null,t.onCancel()},this.transition+10,this),this},confirm:function(){if(this.rect){var e=this.rect.normalize();if(this.returnPixelCoordinates){var i=this.viewer.viewport.viewportToImageRectangle(e);i=t.SelectionRect.fromRect(i).round(),i.rotation=e.rotation,e=i}this.viewer.raiseEvent("selection",e),this.undraw()}return this},cancel:function(){return this.outerTracker.setTracking(!1),this.outerTracker.setTracking(!0),this.viewer.raiseEvent("selection_cancel",!1),this.undraw()}})}(OpenSeadragon),function(t){"use strict";t.SelectionOverlay=function(e,i){t.Overlay.apply(this,arguments),t.isPlainObject(e)?this.rotation=e.location.rotation||0:this.rotation=i.rotation||0},t.SelectionOverlay.prototype=t.extend(Object.create(t.Overlay.prototype),{drawHTML:function(){t.Overlay.prototype.drawHTML.apply(this,arguments),this.style.transform=this.style.transform.replace(/ ?rotate\(.+rad\)/,"")+" rotate("+this.rotation+"rad)"},update:function(e){t.Overlay.prototype.update.apply(this,arguments),this.rotation=e.rotation||0}})}(OpenSeadragon),function(t){"use strict";t.SelectionRect=function(e,i,s,n,r){t.Rect.apply(this,[e,i,s,n]),this.rotation=r||0},t.SelectionRect.fromRect=function(e){return new t.SelectionRect(e.x,e.y,e.width,e.height)},t.SelectionRect.prototype=t.extend(Object.create(t.Rect.prototype),{clone:function(){return new t.SelectionRect(this.x,this.y,this.width,this.height,this.rotation)},equals:function(e){return t.Rect.prototype.equals.apply(this,[e])&&this.rotation===e.rotation},toString:function(){return"["+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+","+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+"@"+Math.round(100*this.rotation)/100+"]"},swapWidthHeight:function(){var t=this.clone();return t.width=this.height,t.height=this.width,t.x+=(this.width-this.height)/2,t.y+=(this.height-this.width)/2,t},getDegreeRotation:function(){return this.rotation*(180/Math.PI)},getAngleFromCenter:function(t){var e=t.minus(this.getCenter());return Math.atan2(e.x,e.y)},round:function(){return new t.SelectionRect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height),this.rotation)},normalize:function(){var t=this.clone();return t.width<0&&(t.x+=t.width,t.width*=-1),t.height<0&&(t.y+=t.height,t.height*=-1),t.rotation%=Math.PI,t},fitsIn:function(t){for(var e=this.normalize(),i=[e.getTopLeft(),e.getTopRight(),e.getBottomRight(),e.getBottomLeft()],s=e.getCenter(),n=e.getDegreeRotation(),r=t.getBottomRight(),h=0;h<4;h++)if(i[h]=i[h].rotate(n,s),i[h].x<t.x||i[h].x>r.x||i[h].y<t.y||i[h].y>r.y)return!1;return!0},reduceRotation:function(){var t;return this.rotation<Math.PI/-4?(t=this.swapWidthHeight(),t.rotation+=Math.PI/2):this.rotation>Math.PI/4?(t=this.swapWidthHeight(),t.rotation-=Math.PI/2):t=this.clone(),t}})}(OpenSeadragon);
//# sourceMappingURL=openseadragonselection.js.map
